<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø±ÙŠØ·Ø© OpenStreetMap Ù…Ø¹ Ø§Ù„Ù†Ù‚Ø§Ø·</title>    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    
    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© jQuery (Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ DOM Ø¨Ø³Ù‡ÙˆÙ„Ø©) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© Leaflet.markercluster (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª) -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-routing-machine/3.2.12/leaflet-routing-machine.min.js"></script>
      
 <style>
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØµÙØ­Ø© */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            box-sizing: border-box;
            position: relative;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
        #map {
            width: 60%;
            height: 500px;
            border-radius: 15px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
            background-color: #eaeaea;
            z-index: 1;
        }

        /* ØªØµÙ…ÙŠÙ… Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #controls {
            width: 35%;
            background-color: #ffffff;
            padding: 25px;
            margin-left: 5%;
            border-radius: 15px;
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.1);
            background: linear-gradient(to right, #f5f7fa, #c3cfe2);
            z-index: 2;
            position: relative;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
        h3 {
            text-align: center;
            font-size: 26px;
            margin-bottom: 20px;
            color: #4a90e2;
        }

        /* ØªØµÙ…ÙŠÙ… Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        label {
            font-size: 16px;
            color: #444;
            margin-bottom: 5px;
            display: block;
        }

        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        /* ØªØ£Ø«ÙŠØ± Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø­Ù‚ÙˆÙ„ */
        input:focus {
            border-color: #66afe9;
            box-shadow: 0 0 5px rgba(102, 175, 233, 0.5);
            outline: none;
            background-color: #ffffff;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø²Ø± */
        .btn {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        .btn:hover {
            background-color: #357ab7;
        }

        /* ØªØ®Ø·ÙŠØ· Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… */
        #controls .row {
            margin-bottom: 15px;
        }

        /* Ø¬Ø¹Ù„ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
        @media (max-width: 768px) {
            #map {
                width: 100%;
                margin-bottom: 20px;
            }

            #controls {
                width: 100%;
                margin-left: 0;
            }
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
        .alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            z-index: 9999;
            font-size: 16px;
            display: none; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ */
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¹Ù†Ø¯ Ø¸Ù‡ÙˆØ±Ù‡ */
        .alert.show {
            display: block;
        }
        
        .search-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 300px;
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
        .suggestions {
            list-style: none;
            margin: 0;
            padding: 0;
            background-color: white;
            border: 1px solid #ccc;
            max-height: 200px;
            overflow-y: auto;
        }
        .suggestions li {
            padding: 5px;
            cursor: pointer;
        }
        .suggestions li:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
  <div class="search-container">
        <input type="text" id="searchBox" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙƒØ§Ù†" class="form-control" autocomplete="off">
        <ul id="suggestions" class="suggestions"></ul>
    </div>
<div id="map"></div>

<div id="controls">
    <h3>Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª </h3> <h3>ØªØ§ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ùˆ Ø§Ù„ÙˆØ¬Ù‡Ø© </h3> <h3>Ù‚Ù… Ø¨Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø±  </h3> <h3>  Ù‚Ù… Ø¨Ù†Ø³Ø® Ù…ÙØªØ§Ø­ Ø§Ù„Ø·Ù„Ø¨ Ù„Ø³ØªØ®Ø¯Ø§Ù…Ù‡ Ù„Ø§Ø­Ù‚Ø§ ÙÙŠ ØªØ§ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ </h3>
  <h3>Ø§ØºÙ„Ù‚ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ù†Ø³Ø® Ù…ÙØªØ§Ø­ Ø§Ù„Ø±Ø­Ù„Ø©  </h3>
    <label for="distance">Ø§Ù„Ù…Ø³Ø§ÙØ©:</label>
    <input type="text" id="distance" placeholder="Ø§Ù„Ù…Ø³Ø§ÙØ© (ÙƒÙ…)" readonly>
    <br>
    <label for="duration">Ø§Ù„Ù…Ø¯Ø©:</label>
    <input type="text" id="duration" placeholder="Ø§Ù„Ù…Ø¯Ø© (Ø¯Ù‚Ø§Ø¦Ù‚)" readonly>
    <br>
       <button class="btn" id="saveRoute">Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø±</button>
 <label for="routeId">Ø§Ù†Ø³Ø® Ø§Ù„Ù…ÙØªØ§Ø­ :</label>
    <input type="text" id="routeId" placeholder="Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø·Ù„Ø¨ Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨" readonly>
    <br> <button class="btn" id="copyRouteId">Ù†Ø³Ø® Ù…ÙØªØ§Ø­ Ø§Ù„Ø·Ù„Ø¨</button>
   <label for="currentLocation">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¹Ø±Ø¶ØŒ Ø·ÙˆÙ„):</label>
<input type="text" id="currentLatitude" placeholder="Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆÙ‚Ø¹" readonly>
<input type="text" id="currentLongitude" placeholder="Ø·ÙˆÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹" readonly>

<br>

<label for="startPoint">Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø¹Ø±Ø¶ØŒ Ø·ÙˆÙ„):</label>
<input type="text" id="startLatitude" placeholder="Ø¹Ø±Ø¶ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" readonly>
<input type="text" id="startLongitude" placeholder="Ø·ÙˆÙ„ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©" readonly>

<br>

<label for="destinationPoint">Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ¬Ù‡Ø© (Ø¹Ø±Ø¶ØŒ Ø·ÙˆÙ„):</label>
<input type="text" id="destinationLatitude" placeholder="Ø¹Ø±Ø¶ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ¬Ù‡Ø©" readonly>
<input type="text" id="destinationLongitude" placeholder="Ø·ÙˆÙ„ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ¬Ù‡Ø©" readonly>

    <br><button class="btn" id="clearRoute">Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±</button> 
   
</div>
<!-- Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ -->
<div class="alert" id="alertMessage">
    <span id="alertText"></span>
</div>
  <!-- Firebase Initialization -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp, query, where, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAYP_0YecYNCgoTKyvuSme9u3pmg-CH1iU",
      authDomain: "korsa-01.firebaseapp.com",
      projectId: "korsa-01",
      storageBucket: "korsa-01.firebasestorage.app",
      messagingSenderId: "240468092018",
      appId: "1:240468092018:web:641db8b472b2c7da0aceeb"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const map = L.map('map').setView([32.8872, 13.1910], 13); // Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ù„Ù‰ Ø·Ø±Ø§Ø¨Ù„Ø³

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);
      // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        $('#searchBox').on('input', function() {
            var query = $(this).val();
            if (query.length > 2) { // Ù„Ø§ ØªØ¨Ø¯Ø£ Ø§Ù„Ø¨Ø­Ø« Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ 3 Ø£Ø­Ø±Ù
                $.ajax({
                    url: 'https://nominatim.openstreetmap.org/search',
                    data: {
                        q: query,
                        format: 'json',
                        addressdetails: 1,
                        limit: 5
                    },
                    success: function(data) {
                        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
                        $('#suggestions').empty();
                        if (data.length > 0) {
                            data.forEach(function(item) {
                                $('#suggestions').append('<li data-lat="'+item.lat+'" data-lon="'+item.lon+'">'+item.display_name+'</li>');
                            });
                        }
                    }
                });
            } else {
                $('#suggestions').empty();
            }
        });

        // Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª
        $(document).on('click', '#suggestions li', function() {
            var lat = $(this).data('lat');
            var lon = $(this).data('lon');
            var placeName = $(this).text();

            // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙ‚Ø·
            map.setView([lat, lon], 15); // ØªØºÙŠÙŠØ± Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯

            // Ø¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±
            $('#suggestions').empty();
            $('#searchBox').val(placeName); // ÙˆØ¶Ø¹ Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† ÙÙŠ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
        });

        // Ø­Ø¯Ø« Ø¹Ù†Ø¯ Ù…Ø³Ø­ Ø§Ù„Ù†Øµ Ù…Ù† Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø­Ø«
        $('#searchBox').on('focus', function() {
            $('#suggestions').empty();
        });
    let startMarker = null;
    let destinationMarker = null;
    let startCoordinates = null;
    let destinationCoordinates = null;
    let routeControl = null;

    let startPointSelected = false;
    let destinationPointSelected = false;

    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    function showAlert(message) {
        const alertElement = document.getElementById('alertMessage');
        alertElement.textContent = message;
        alertElement.classList.add('show');
        setTimeout(() => {
            alertElement.classList.remove('show');
        }, 4000);
    }
 // Ø¯Ø§Ù„Ø© Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø± ÙÙŠ Firebase
async function saveRouteToFirebase() {
    if (startCoordinates && destinationCoordinates) {
        try {
            const routeData = {
                startPoint: {
                    lat: startCoordinates[0],
                    lng: startCoordinates[1]
                },
                destinationPoint: {
                    lat: destinationCoordinates[0],
                    lng: destinationCoordinates[1]
                },
                distance: document.getElementById('distance').value,
                duration: document.getElementById('duration').value,
                timestamp: serverTimestamp()  // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø·Ø§Ø¨Ø¹ Ø§Ù„Ø²Ù…Ù†ÙŠ Ù„Ù„Ø®Ø§Ø¯Ù…
            };

            const docRef = await addDoc(collection(db, "routes"), routeData);

            // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø¹ ID Ø§Ù„Ù…Ø³Ø§Ø±
            showAlert(`ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­! ID Ø§Ù„Ù…Ø³Ø§Ø± Ù‡Ùˆ: ${docRef.id}`);

            // Ø¹Ø±Ø¶ Ø§Ù„Ù€ ID ÙÙŠ Ø§Ù„Ø­Ù‚Ù„
            document.getElementById('routeId').value = docRef.id;
            
            console.log("Document written with ID: ", docRef.id);
        } catch (e) {
            console.error("Error adding document: ", e);
            showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø±. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
    } else {
        showAlert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„ÙˆØ¬Ù‡Ø© Ø£ÙˆÙ„Ø§Ù‹.');
    }
}


    // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± "Ø­ÙØ¸ Ø§Ù„Ù…Ø³Ø§Ø±" Ù…Ø¹ Ø§Ù„Ø¯Ø§Ù„Ø©
    document.getElementById('saveRoute').addEventListener('click', saveRouteToFirebase);
    
    // Ø¯Ø§Ù„Ø© Ù„Ù†Ø³Ø® Ø§Ù„Ù€ ID Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
    function copyRouteIdToClipboard() {
        const routeIdInput = document.getElementById('routeId');
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Øµ Ø¯Ø§Ø®Ù„ Ø­Ù‚Ù„ Ø§Ù„Ù€ ID
        routeIdInput.select();
        routeIdInput.setSelectionRange(0, 99999); // Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Øµ ÙÙŠ Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù‡Ø§ØªÙ Ø£ÙŠØ¶Ù‹Ø§

        // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
        document.execCommand('copy');

        // Ø¹Ø±Ø¶ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ù† Ø§Ù„Ù€ ID ØªÙ… Ù†Ø³Ø®Ù‡ Ø¨Ù†Ø¬Ø§Ø­
        showAlert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù€ ID Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©.');
    }

    // Ø±Ø¨Ø· Ø§Ù„Ø²Ø± "Ù†Ø³Ø® Ø§Ù„Ù€ ID" Ù…Ø¹ Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø®
    document.getElementById('copyRouteId').addEventListener('click', copyRouteIdToClipboard);

    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø±
    function updateRoute() {
        if (startCoordinates && destinationCoordinates) {
            if (routeControl) map.removeControl(routeControl);

            routeControl = L.Routing.control({
                waypoints: [
                    L.latLng(startCoordinates[0], startCoordinates[1]),
                    L.latLng(destinationCoordinates[0], destinationCoordinates[1])
                ],
                routeWhileDragging: true,
                createMarker: () => null,
                show: false,
                addWaypoints: false,
                lineOptions: {
                    styles: [
                        { color: 'green', weight: 4, opacity: 0.7 } // ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„Ù…Ø³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®Ø¶Ø±
                    ]
                }
            }).on('routesfound', (e) => {
                const routes = e.routes;
                const distance = routes[0].summary.totalDistance / 1000;
                const duration = routes[0].summary.totalTime / 60;

                document.getElementById('distance').value = distance.toFixed(2) + ' ÙƒÙ…';
                document.getElementById('duration').value = duration.toFixed(2) + ' Ø¯Ù‚ÙŠÙ‚Ø©';

                const routeContainer = document.querySelector('.leaflet-routing-container');
                if (routeContainer) routeContainer.style.display = 'none';
            }).addTo(map);
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… GPS
 function setCurrentLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
            document.getElementById('currentLatitude').value = lat;
            document.getElementById('currentLongitude').value = lng;

            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
            map.setView([lat, lng], 13);

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ†Ù‚Ø·Ø© Ø¨Ø¯Ø§ÙŠØ©
            startCoordinates = [lat, lng];
            if (startMarker) map.removeLayer(startMarker);
            startMarker = L.marker([lat, lng], { 
                draggable: true, 
                icon: L.divIcon({ className: 'leaflet-div-icon', html: 'ğŸ”´', iconSize: [20, 20] }) 
            }).addTo(map).bindPopup('Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©').openPopup();
            document.getElementById('startLatitude').value = lat;
            document.getElementById('startLongitude').value = lng;

            // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡
            showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨Ù†Ø¬Ø§Ø­ ÙƒÙ…ÙˆÙ‚Ø¹ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.');

            startPointSelected = true;

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            updateRoute();

            // Ø¹Ù†Ø¯ ØªØ­Ø±ÙŠÙƒ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            startMarker.on('dragend', () => {
                const position = startMarker.getLatLng();
                startCoordinates = [position.lat, position.lng];
                document.getElementById('startLatitude').value = position.lat;
                document.getElementById('startLongitude').value = position.lng;
                updateRoute();
            });

        }, function(error) {
            console.log(error);
            showAlert('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ');
        });
    } else {
        showAlert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© GPS');
    }
}


    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
    window.onload = setCurrentLocation;

 map.on('click', (e) => {
    if (!startPointSelected) {
        const { lat, lng } = e.latlng;
        if (startMarker) map.removeLayer(startMarker);
        startMarker = L.marker([lat, lng], { 
            draggable: true, 
            icon: L.divIcon({ className: 'leaflet-div-icon', html: 'ğŸ”´', iconSize: [20, 20] }) 
        }).addTo(map).bindPopup('Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©').openPopup();
        startCoordinates = [lat, lng];
        document.getElementById('startLatitude').value = lat;
        document.getElementById('startLongitude').value = lng;

        startMarker.on('dragend', () => {
            const position = startMarker.getLatLng();
            startCoordinates = [position.lat, position.lng];
            document.getElementById('startLatitude').value = position.lat;
            document.getElementById('startLongitude').value = position.lng;
            updateRoute();
        });

        startPointSelected = true;
        showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­. Ø§Ù„Ø¢Ù†ØŒ Ø­Ø¯Ø¯ Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ¬Ù‡Ø©.');
    } else if (startPointSelected && !destinationPointSelected) {
        const { lat, lng } = e.latlng;
        if (destinationMarker) map.removeLayer(destinationMarker);
        destinationMarker = L.marker([lat, lng], { 
            draggable: true, 
            icon: L.divIcon({ className: 'leaflet-div-icon', html: 'âŒ', iconSize: [20, 20] }) 
        }).addTo(map).bindPopup('Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØ¬Ù‡Ø©').openPopup();
        destinationCoordinates = [lat, lng];
        document.getElementById('destinationLatitude').value = lat;
        document.getElementById('destinationLongitude').value = lng;

        destinationMarker.on('dragend', () => {
            const position = destinationMarker.getLatLng();
            destinationCoordinates = [position.lat, position.lng];
            document.getElementById('destinationLatitude').value = position.lat;
            document.getElementById('destinationLongitude').value = position.lng;
            updateRoute();
        });

        destinationPointSelected = true;
        updateRoute();
    }
});


    // Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±
    document.getElementById('clearRoute').addEventListener('click', () => {
        document.getElementById('startPoint').value = '';
        document.getElementById('destinationPoint').value = '';
        document.getElementById('distance').value = '';
        document.getElementById('duration').value = '';

        if (startMarker) map.removeLayer(startMarker);
        if (destinationMarker) map.removeLayer(destinationMarker);
        if (routeControl) map.removeControl(routeControl);

        startCoordinates = null;
        destinationCoordinates = null;
        startPointSelected = false;
        destinationPointSelected = false;

        showAlert('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…Ø³Ø§Ø±. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„ÙˆØ¬Ù‡Ø© Ù…Ù† Ø¬Ø¯ÙŠØ¯.');
    });// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
// ØªØ¹Ø±ÙŠÙ Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚
let previousLocation = null;
let currentLocationMarker = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
function updateCurrentLocation() {
    // Ù‡Ù†Ø§ Ù†ÙØªØ±Ø¶ Ø£Ù† Ù‚ÙŠÙ…Ø© Ø­Ù‚Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙŠØªÙ… Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Ù…ÙƒØ§Ù† Ø¢Ø®Ø± (Ù…Ø«Ø§Ù„: Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ API)
    const currentLocationValue = document.getElementById('currentLocation').value;

    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ø§ ØªØ³Ø§ÙˆÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    if (currentLocationValue !== previousLocation) {
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¨Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        previousLocation = currentLocationValue;

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¥Ù„Ù‰ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª (Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ "Lat, Lng")
        const [lat, lng] = currentLocationValue.split(',').map(Number);

        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ØµØ­ÙŠØ­Ø©
        if (!isNaN(lat) && !isNaN(lng)) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            map.setView([lat, lng], 13);

            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠØŒ Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø²Ø§Ù„ØªÙ‡Ø§
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
            }

            // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
            currentLocationMarker = L.marker([lat, lng], { 
                draggable: true, 
                icon: L.divIcon({ className: 'leaflet-div-icon', html: 'ğŸ”µ', iconSize: [20, 20] })
            }).addTo(map).bindPopup('Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ').openPopup();
        }
    }
}

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
setInterval(updateCurrentLocation, 5000);


</script>

</body>
</html>
